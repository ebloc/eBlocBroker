                            *outline*
* TASKS
** TODO log ~dataTransferIn~ in the contract
- self.eBlocBroker.decode_input(input)
- testte dataTransferIn hep [0, 0, 0, 0] olarak hesaplanmis?
** TODO patch bdrop and google-drive
** TODO verify downloaded data
** TODO convert ~ipfsID~ into ~ipfsAddress~ in the ~eBlocBrokerInterface.sol~
** TODO Test updated code in 2 machines with your test cast submitting job.
** TODO IPFS inside docker should be swarm connect from outside
** TODO Do demo video do from https://asciinema.org/a/480875 , you can copy string from the video
** TODO check ? dataPricesSetBlockNum > 0 is true at checkRegisteredData() for registered data usage
** TODO check ? in smart-contract in ~internal~ calls is if memory variable updated does it updated as well on where it called from
** TODO token
– https://docs.openzeppelin.com/contracts/2.x/erc20
– https://github.com/OpenZeppelin/openzeppelin-contracts/tree/master/contracts/token/ERC20
** TODO get_transaction_receipt console'a ekle
** TODO rootless docker in the compute nodes
https://serverfault.com/a/1078434/395276
** TODO https://www.mturk.com
** TODO apply patched for all the folders
** TODO Later do, when cache time is completed:
   oc.decline_remote_share(int(<share_id>)) to cancel shared folder at
   end_code or after some time later
** TODO /* Sets the job's state (stateCode) which is obtained from Slurm */
Slurm status should be set on the receiveDeposit call not setJobStatus
** TODO DAS2-fs1-2003-1.swf
   Starting from // 5955  9447070
   __ https://www.cse.huji.ac.il/labs/parallel/workload/l_das2/index.html
** TODO oc may have "owncloud.owncloud.HTTPResponseError: HTTP error: 401" error
** TODO Some code should go into utils.py
   Some functıons are public that should carried into ~utils.py~
** TODO for workflow visualization: https://github.com/mermaid-js/mermaid
** TODO remove _balance? could be not needed.
** TODO BUGS
#+begin_src python
Failed to share file: googleapi: Error 403: Rate limit exceeded. User message: "Sorry, you have exceeded your sharing quota.", sharingRateLimitExceeded
#+end_src
** TODO fetch b2drop empty size
** TODO investigate store web3 ebb object and read reread from it using picle
** TODO
*** hide ipfs progress in submitting jobs
*** Failed to get about:
#+begin_src bash
Get "https://www.googleapis.com/drive/v3/about?alt=json&fields=maxImportSizes%2CmaxUploadSize%2CstorageQuota%2Cuser": oauth2: cannot fetch token: 400 Bad Request
Response: {
  "error": "invalid_grant",
  "error_description": "Token has been expired or revoked."
}
#+end_src

** TODO freeze at
#+begin_src bash
==> since driver started provider_gained_token=0 usd
 * 2023-04-06 08:34:46 waiting new job to come since bn=19922833
==> current_block=19922819 | sync_from=19922833
## Waiting block number to be updated, it remains constant at 19922819
Downloading meta_data.json -> /var/ebloc-broker/b68d6462f9762cfed7bbc7f90e6c6c7f/1KFwXV2UWnJwj25HS3wdrjcQxartboQAW_0/meta_data.json
#+end_src


** TODO max retry

#+begin_src bash
E: HTTPConnectionPool(host='alpy-bloxberg.duckdns.org', port=8545): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at
0x7ff54c057fd0>: Failed to establish a new connection: [Errno 111] Connection refused'))
E: bloxberg is not connected through http://alpy-bloxberg.duckdns.org:8545
Trying at bloxberg_core... Exception in thread Thread-2:
Traceback (most recent call last):
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connection.py", line 174, in _new_conn
    conn = connection.create_connection(
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/util/connection.py", line 95, in create_connection
    raise err
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/util/connection.py", line 85, in create_connection
    sock.connect(sa)
ConnectionRefusedError: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connectionpool.py", line 703, in urlopen
    httplib_response = self._make_request(
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connectionpool.py", line 398, in _make_request
    conn.request(method, url, **httplib_request_kw)
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connection.py", line 239, in request
    super(HTTPConnection, self).request(method, url, body=body, headers=headers)
  File "/usr/lib/python3.8/http/client.py", line 1256, in request
    self._send_request(method, url, body, headers, encode_chunked)
  File "/usr/lib/python3.8/http/client.py", line 1302, in _send_request
    self.endheaders(body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.8/http/client.py", line 1251, in endheaders
    self._send_output(message_body, encode_chunked=encode_chunked)
  File "/usr/lib/python3.8/http/client.py", line 1011, in _send_output
    self.send(msg)
  File "/usr/lib/python3.8/http/client.py", line 951, in send
    self.connect()
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connection.py", line 205, in connect
    conn = self._new_conn()
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connection.py", line 186, in _new_conn
    raise NewConnectionError(
urllib3.exceptions.NewConnectionError: <urllib3.connection.HTTPConnection object at 0x7ff54c0697c0>: Failed to establish a new connection: [Errno 111] Connection refused

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/alper/venv/lib/python3.8/site-packages/requests/adapters.py", line 489, in send
    resp = conn.urlopen(
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    retries = retries.increment(
  File "/home/alper/venv/lib/python3.8/site-packages/urllib3/util/retry.py", line 592, in increment
    raise MaxRetryError(_pool, url, error or ResponseError(cause))
urllib3.exceptions.MaxRetryError: HTTPConnectionPool(host='alpy-bloxberg.duckdns.org', port=8545): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7ff54c0697c0>: Failed to establish a new connection: [Errno 111] Connection refused'))

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/usr/lib/python3.8/threading.py", line 932, in _bootstrap_inner
    self.run()
  File "/usr/lib/python3.8/threading.py", line 870, in run
    self._target(*self._args, **self._kwargs)
  File "/home/alper/venv/lib/python3.8/site-packages/brownie/network/middlewares/caching.py", line 156, in block_filter_loop
    new_blocks = self.block_filter.get_new_entries()
  File "/home/alper/venv/lib/python3.8/site-packages/web3/_utils/filters.py", line 160, in get_new_entries
    log_entries = self._filter_valid_entries(self.eth_module.get_filter_changes(self.filter_id))
  File "/home/alper/venv/lib/python3.8/site-packages/web3/module.py", line 57, in caller
    result = w3.manager.request_blocking(method_str,
  File "/home/alper/venv/lib/python3.8/site-packages/web3/manager.py", line 197, in request_blocking
    response = self._make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/manager.py", line 150, in _make_request
    return request_func(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/brownie/network/middlewares/caching.py", line 202, in process_request
    return make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/formatting.py", line 94, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/gas_price_strategy.py", line 90, in middleware
    return make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/formatting.py", line 94, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/attrdict.py", line 33, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/formatting.py", line 94, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/formatting.py", line 94, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/formatting.py", line 94, in middleware
    response = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/buffered_gas_estimate.py", line 40, in middleware
    return make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/brownie/network/middlewares/catch_tx_revert.py", line 24, in process_request
    result = make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/middleware/exception_retry_request.py", line 105, in middleware
    return make_request(method, params)
  File "/home/alper/venv/lib/python3.8/site-packages/web3/providers/rpc.py", line 88, in make_request
    raw_response = make_post_request(
  File "/home/alper/venv/lib/python3.8/site-packages/web3/_utils/request.py", line 112, in make_post_request
    response = session.post(endpoint_uri, data=data, *args, **kwargs)  # type: ignore
  File "/home/alper/venv/lib/python3.8/site-packages/requests/sessions.py", line 635, in post
    return self.request("POST", url, data=data, json=json, **kwargs)
  File "/home/alper/venv/lib/python3.8/site-packages/requests/sessions.py", line 587, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/alper/venv/lib/python3.8/site-packages/requests/sessions.py", line 701, in send
    r = adapter.send(request, **kwargs)
  File "/home/alper/venv/lib/python3.8/site-packages/requests/adapters.py", line 565, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: HTTPConnectionPool(host='alpy-bloxberg.duckdns.org', port=8545): Max retries exceeded with url: / (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x7ff54c0697c0>: Failed to establish a new connection: [Errno 111] Connection refused'))
#+end_src

REQUESTER job submitter freezes at:
#+begin_src bash
warning: timeout function took too long


^C^C[  submit.py:38  ] Traceback (most recent call last):
  File "/home/alper/ebloc-broker/broker/gdrive/submit.py", line 28, in _submit
    tx_hash = Ebb.submit_job(provider, key, job, requester=requester, required_confs=required_confs)
  File "/home/alper/ebloc-broker/broker/eblocbroker_scripts/submit_job.py", line 172, in submit_job
    raise e  # "No valid Tx receipt is generated"
  File "/home/alper/ebloc-broker/broker/eblocbroker_scripts/submit_job.py", line 150, in submit_job
    tx = self._submit_job(
  File "/home/alper/ebloc-broker/broker/eblocbroker_scripts/Contract.py", line 465, in _submit_job
    raise Exception("No valid Tx receipt is generated")
Exception: No valid Tx receipt is generated

/home/alper/test_eblocbroker/NPB3.3-SER_source_code => 586bb85c3f8d400d3407725c432d157c
[  submit_jobs.py:295  ] Traceback (most recent call last):
  File "./submit_jobs.py", line 276, in run_job
    tx_hash = submit_base.submit(is_pass=True)
  File "/home/alper/ebloc-broker/broker/submit_base.py", line 22, in submit
    return submit_gdrive(self.job, is_pass, required_confs)
  File "/home/alper/ebloc-broker/broker/gdrive/submit.py", line 85, in submit_gdrive
    return _submit(job, provider_addr_to_submit, key, requester, required_confs)
  File "/home/alper/ebloc-broker/broker/gdrive/submit.py", line 44, in _submit
    return tx_hash
UnboundLocalError: local variable 'tx_hash' referenced before assignment
An exception of type UnboundLocalError occurred. Arguments:
("local variable 'tx_hash' referenced before assignment",)
^CError in atexit._run_exitfuncs:
Traceback (most recent call last):
  File "/home/alper/venv/lib/python3.8/site-packages/pymongo/periodic_executor.py", line 99, in join
    self._thread.join(timeout)
  File "/usr/lib/python3.8/threading.py", line 1015, in join
    self._wait_for_tstate_lock(timeout=max(timeout, 0))
  File "/usr/lib/python3.8/threading.py", line 1027, in _wait_for_tstate_lock
    elif lock.acquire(block, timeout):
KeyboardInterrupt
#+end_src


** TODO dbus error in docker

#+begin_src bash
root@home:/var/log/slurm$ slurmd -N linux2 -Dvvvvvvv
slurmd: debug:  Log file re-opened
slurmd: debug2: hwloc_topology_init
slurmd: debug2: hwloc_topology_load
slurmd: debug2: hwloc_topology_export_xml
slurmd: debug:  CPUs:4 Boards:1 Sockets:4 CoresPerSocket:1 ThreadsPerCore:1
slurmd: debug4: CPU map[0]=>0 S:C:T 0:0:0
slurmd: debug4: CPU map[1]=>1 S:C:T 1:0:0
slurmd: debug4: CPU map[2]=>2 S:C:T 2:0:0
slurmd: debug4: CPU map[3]=>3 S:C:T 3:0:0
slurmd: error: Node configuration differs from hardware: CPUs=0:4(hw) Boards=0:1(hw) SocketsPerBoard=0:4(hw) CoresPerSocket=0:1(hw) ThreadsPerCore=0:1(hw)
slurmd: debug3: Trying to load plugin /usr/lib64/slurm/cgroup_v2.so
slurmd: debug3: plugin_load_from_file->_verify_syms: found Slurm plugin name:Cgroup v2 plugin type:cgroup/v2 version:0x160502
slurmd: error: cgroup_dbus_attach_to_scope: cannot connect to dbus system daemon: Failed to connect to socket /run/dbus/system_bus_socket: No such file or directory
slurmd: error: _init_new_scope_dbus: scope and/or cgroup directory for slurmstepd could not be set.
slurmd: error: cannot initialize cgroup directory for stepds
slurmd: error: Couldn't load specified plugin name for cgroup/v2: Plugin init() callback failed
slurmd: error: cannot create cgroup context for cgroup/v2
slurmd: error: Unable to initialize cgroup plugin
slurmd: error: slurmd initialization failed
#+end_src
